---
seo:
   title: 事件分块
   description: 如果事件流平台对事件有自然或配置的大小限制，不要存储整个事件，而是将其分解为块
---

# 事件分块

有时压缩可以减少消息大小，但各种用例涉及大型消息负载，其中压缩可能不够。
这些用例通常与图像、视频或音频处理相关：图像识别、视频分析、音频分析等。

## 问题

如何处理事件负载太大而无法作为单个事件通过事件流平台的用例？

## 解决方案

![chunking](../img/event-chunking.svg)

不要将整个事件作为单个事件存储在事件流平台中，而是将其分解为块（一种称为"分块"的方法），以便大型事件作为多个较小事件发送。
生产者可以在将事件写入事件流平台时进行分块。
下游客户端消费块，当接收到所有较小的块时，重新组合（"解块"）它们以恢复原始事件。

## 实现

使用元数据跟踪每个块，以便可以将它们与其各自的父事件关联：

- 任何给定块与其父事件之间的关联
- 块在父事件中的位置
- 父事件的总块数

## 注意事项

分块对客户端应用程序施加了额外的负担。
首先，实现分块和解块逻辑需要更多的应用程序开发。
其次，消费者应用程序需要能够缓存块，因为它等待接收构成原始事件的所有较小块。
这反过来可能对内存碎片和更长的垃圾收集（GC）产生影响。缓解这取决于编程语言：例如，在Java中，可以调整JVM堆大小和GC。

不了解用于分块事件的协议的客户端应用程序可能无法准确重建原始事件。

## 参考资料

* 要处理大型事件，可能更优选的替代方法是[声明检查](../event-processing/claim-check.md)
